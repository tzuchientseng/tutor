import{f as u}from"./index-DOeknWn7.js";const i="https://home.sunnytseng.com/api/tutor/users",l=u("auth",{state:()=>{const e=sessionStorage.getItem("user")||localStorage.getItem("user"),s=e?JSON.parse(e):null;return{user:s,token:(s==null?void 0:s.token)||null}},getters:{isAuthenticated:e=>!!e.token,isSuperuser:e=>{var s;return!!((s=e.user)!=null&&s.is_superuser)},getUserName:e=>{var s;return((s=e.user)==null?void 0:s.name)??"Guest"},authHeader:e=>e.token?{Authorization:`Bearer ${e.token}`}:{}},actions:{async login(e,s,n=!1){try{const t=await fetch(`${i}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:e,password:s})}),r=await t.json();if(!t.ok){const o=r.detail||"Login failed";throw o.includes("not found")?new Error("Account does not exist"):o.includes("disabled")||o.includes("inactive")?new Error("Account is not active"):o.includes("password")?new Error("Incorrect password"):new Error(o)}const a={id:r.user.id,name:r.user.name,account:r.user.account,is_superuser:!!r.user.is_superuser,token:r.access};return this.setUser(a,n),{success:!0}}catch(t){return t instanceof Error?(console.error("Login error:",t.message),{success:!1,message:t.message}):{success:!1,message:"An unknown error occurred"}}},setUser(e,s=!1){this.user=e,this.token=e.token;const n=s?localStorage:sessionStorage;n.setItem("user",JSON.stringify(e)),n.setItem("token",e.token||"")},logout(){this.user=null,this.token=null,sessionStorage.removeItem("user"),sessionStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("token")}}});export{l as u};
