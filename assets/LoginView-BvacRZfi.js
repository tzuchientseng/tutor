import{f as A,d as I,r as w,u as L,c as f,o as c,g as h,a as n,v as k,x as B,w as O,_ as g,y as C,q as v,z as E,p as _,l as y,F as S,e as x,t as U}from"./index-D-eIen4V.js";import{S as m}from"./sweetalert2.esm.all-BQIkj5Wb.js";const b="https://home.sunnytseng.com/api/tutor/users",$=A("auth",{state:()=>{const e=sessionStorage.getItem("user")||localStorage.getItem("user"),t=e?JSON.parse(e):null;return{user:t,token:(t==null?void 0:t.token)||null}},getters:{isAuthenticated:e=>!!e.token,getUserName:e=>{var t;return((t=e.user)==null?void 0:t.name)??"Guest"}},actions:{async login(e,t,r=!1){try{const s=await fetch(`${b}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:e,password:t})}),a=await s.json();if(!s.ok){const u=a.detail||"Login failed";throw u.includes("not found")?new Error("Account does not exist"):u.includes("disabled")||u.includes("inactive")?new Error("Account is not active"):u.includes("password")?new Error("Incorrect password"):new Error(u)}const o={name:a.user.name,account:a.user.account,token:a.access};return this.setUser(o,r),{success:!0}}catch(s){return s instanceof Error?(console.error("Login error:",s.message),{success:!1,message:s.message}):{success:!1,message:"An unknown error occurred"}}},async register(e,t,r,s,a){try{const o=await fetch(`${b}/register/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,account:t,password:r,email:s,phone:a})});if(!o.ok){const u=await o.json();throw new Error(u.detail||"Registration failed")}return{success:!0}}catch(o){return o instanceof Error?(console.error("Registration error:",o.message),{success:!1,message:o.message}):{success:!1,message:"An unknown error occurred"}}},setUser(e,t=!1){this.user=e,this.token=e.token;const r=t?localStorage:sessionStorage;r.setItem("user",JSON.stringify(e)),r.setItem("token",e.token||"")},logout(){this.user=null,this.token=null,sessionStorage.removeItem("user"),sessionStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("token")}}}),V={class:"custom-checkbox-wrapper"},T=I({__name:"LoginForm",emits:["login-success"],setup(e,{emit:t}){const r=t,s=w(""),a=w(""),o=w(!1),u=L(),i=$();async function N(){m.fire({title:"Logging in...",text:"Please wait while we log you in.",allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>m.showLoading()});const p=await i.login(s.value,a.value,o.value);m.close(),p.success?m.fire({title:"Success",text:"Login successful!",icon:"success",confirmButtonColor:"#3085d6"}).then(()=>{r("login-success"),u.push("/")}):m.fire({title:"Login Failed",text:p.message,icon:"warning",confirmButtonText:"OK",confirmButtonColor:"#3085d6"})}return(p,l)=>(c(),f("form",{id:"login-form",onSubmit:O(N,["prevent"])},[h(n("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=d=>s.value=d),placeholder:"帳號",required:""},null,512),[[k,s.value]]),h(n("input",{type:"password","onUpdate:modelValue":l[1]||(l[1]=d=>a.value=d),placeholder:"密碼",required:""},null,512),[[k,a.value]]),n("label",null,[n("span",V,[h(n("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=d=>o.value=d)},null,512),[[B,o.value]]),l[3]||(l[3]=n("span",{class:"custom-checkbox"},null,-1))]),l[4]||(l[4]=n("span",{class:"custom-checkbox-text"},"保持登入",-1))]),l[5]||(l[5]=n("button",{type:"submit"},"登入",-1))],32))}}),F=g(T,[["__scopeId","data-v-16549392"]]),j={},J={id:"background"};function P(e,t){return c(),f("div",J,[C(e.$slots,"default",{},void 0)])}const R=g(j,[["render",P],["__scopeId","data-v-22038a82"]]),q={},D={id:"card-container"};function M(e,t){return c(),f("div",D,[C(e.$slots,"default",{},void 0)])}const z=g(q,[["render",M],["__scopeId","data-v-399f7c81"]]),G={class:"user-name"},K=I({__name:"LoginView",setup(e){const t=L(),r=$(),s=v(()=>r.isAuthenticated),a=v(()=>r.getUserName),o=()=>{r.logout(),t.push("/")};return(u,i)=>(c(),E(R,null,{default:_(()=>[y(z,null,{default:_(()=>[s.value?(c(),f(S,{key:0},[n("h2",null,[i[0]||(i[0]=x(" 歡迎 ~ ",-1)),n("span",G,U(a.value),1),i[1]||(i[1]=x(" ! ",-1))]),i[2]||(i[2]=n("h3",null,"您已登入",-1)),n("button",{class:"logout-button",onClick:o},"登出")],64)):(c(),f(S,{key:1},[i[3]||(i[3]=n("h2",null,"歡迎登入!",-1)),i[4]||(i[4]=n("h3",null,"請填寫帳號密碼",-1)),y(F)],64))]),_:1})]),_:1}))}}),W=g(K,[["__scopeId","data-v-cadadf26"]]);export{W as default};
