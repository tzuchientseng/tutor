import{f as g}from"./index-3QLdzJru.js";const i="https://home.sunnytseng.com/api/tutor/users",d=g("auth",{state:()=>{const e=sessionStorage.getItem("user")||localStorage.getItem("user"),s=e?JSON.parse(e):null;return{user:s,token:(s==null?void 0:s.token)||null}},getters:{isAuthenticated:e=>!!e.token,isSuperuser:e=>{var s;return!!((s=e.user)!=null&&s.is_superuser)},getUserName:e=>{var s;return((s=e.user)==null?void 0:s.name)??"Guest"},authHeader:e=>e.token?{Authorization:`Bearer ${e.token}`}:{}},actions:{async login(e,s,a=!1){try{const t=await fetch(`${i}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:e,password:s})}),r=await t.json();if(!t.ok){const n=r.detail||"Login failed";throw n.includes("not found")?new Error("Account does not exist"):n.includes("disabled")||n.includes("inactive")?new Error("Account is not active"):n.includes("password")?new Error("Incorrect password"):new Error(n)}const o={id:r.user.id,name:r.user.name,account:r.user.account,is_superuser:!!r.user.is_superuser,token:r.access};return this.setUser(o,a),{success:!0}}catch(t){return t instanceof Error?(console.error("Login error:",t.message),{success:!1,message:t.message}):{success:!1,message:"An unknown error occurred"}}},async register(e,s,a,t,r){try{const o=await fetch(`${i}/register/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,account:s,password:a,email:t,phone:r})});if(!o.ok){const n=await o.json(),c=Object.entries(n).map(([u,l])=>`<li><strong>${u}</strong>: ${l.join(", ")}</li>`).join("");throw new Error(`<ul style="text-align:left;">${c}</ul>`)}return{success:!0}}catch(o){return o instanceof Error?{success:!1,message:o.message}:{success:!1,message:"An unknown error occurred"}}},setUser(e,s=!1){this.user=e,this.token=e.token;const a=s?localStorage:sessionStorage;a.setItem("user",JSON.stringify(e)),a.setItem("token",e.token||"")},logout(){this.user=null,this.token=null,sessionStorage.removeItem("user"),sessionStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("token")}}});export{d as u};
