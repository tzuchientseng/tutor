import{f as M,d as _,r as p,u as T,c as h,o as y,g,a as e,v as w,y as R,w as S,_ as b,t as E,z as q,q as $,x as I,p as V,l as L,k as O,F as U,e as x}from"./index-CBJXoaxL.js";import{S as v}from"./sweetalert2.esm.all-BQIkj5Wb.js";const N="https://home.sunnytseng.com/api/tutor/users",C=M("auth",{state:()=>{const o=sessionStorage.getItem("user")||localStorage.getItem("user"),r=o?JSON.parse(o):null;return{user:r,token:(r==null?void 0:r.token)||null}},getters:{isAuthenticated:o=>!!o.token,getUserName:o=>{var r;return((r=o.user)==null?void 0:r.name)??"Guest"}},actions:{async login(o,r,u=!1){try{const l=await fetch(`${N}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:o,password:r})}),a=await l.json();if(!l.ok){const i=a.detail||"Login failed";throw i.includes("not found")?new Error("Account does not exist"):i.includes("disabled")||i.includes("inactive")?new Error("Account is not active"):i.includes("password")?new Error("Incorrect password"):new Error(i)}const n={name:a.user.name,account:a.user.account,token:a.access};return this.setUser(n,u),{success:!0}}catch(l){return l instanceof Error?(console.error("Login error:",l.message),{success:!1,message:l.message}):{success:!1,message:"An unknown error occurred"}}},async register(o,r,u,l,a){try{const n=await fetch(`${N}/register/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,account:r,password:u,email:l,phone:a})});if(!n.ok){const i=await n.json(),d=Object.entries(i).map(([m,c])=>`<li><strong>${m}</strong>: ${c.join(", ")}</li>`).join("");throw new Error(`<ul style="text-align:left;">${d}</ul>`)}return{success:!0}}catch(n){return n instanceof Error?{success:!1,message:n.message}:{success:!1,message:"An unknown error occurred"}}},setUser(o,r=!1){this.user=o,this.token=o.token;const u=r?localStorage:sessionStorage;u.setItem("user",JSON.stringify(o)),u.setItem("token",o.token||"")},logout(){this.user=null,this.token=null,sessionStorage.removeItem("user"),sessionStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("token")}}}),j={class:"custom-checkbox-wrapper"},P=_({__name:"LoginForm",emits:["login-success"],setup(o,{emit:r}){const u=r,l=p(""),a=p(""),n=p(!1),i=T(),d=C();async function m(){v.fire({title:"Logging in...",text:"Please wait while we log you in.",allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>v.showLoading()});const c=await d.login(l.value,a.value,n.value);v.close(),c.success?v.fire({title:"Success",text:"Login successful!",icon:"success",confirmButtonColor:"#3085d6"}).then(()=>{u("login-success"),i.push("/")}):v.fire({title:"Login Failed",text:c.message,icon:"warning",confirmButtonText:"OK",confirmButtonColor:"#3085d6"})}return(c,s)=>(y(),h("form",{id:"login-form",onSubmit:S(m,["prevent"])},[g(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=k=>l.value=k),placeholder:"帳號",required:""},null,512),[[w,l.value]]),g(e("input",{type:"password","onUpdate:modelValue":s[1]||(s[1]=k=>a.value=k),placeholder:"密碼",required:""},null,512),[[w,a.value]]),e("label",null,[e("span",j,[g(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=k=>n.value=k)},null,512),[[R,n.value]]),s[3]||(s[3]=e("span",{class:"custom-checkbox"},null,-1))]),s[4]||(s[4]=e("span",{class:"custom-checkbox-text"},"保持登入",-1))]),s[5]||(s[5]=e("button",{type:"submit"},"登入",-1))],32))}}),F=b(P,[["__scopeId","data-v-16549392"]]),K={class:"form-wrapper"},J={class:"form-group"},D={class:"form-group"},z={class:"form-group"},G={class:"form-group"},H={class:"form-group"},Q={class:"form-group"},W=["disabled"],X=["disabled"],Y=_({__name:"RegisterModal",emits:["success","cancel"],setup(o,{emit:r}){const u=r,l=p(""),a=p(""),n=p(""),i=p(""),d=p(""),m=p(""),c=p(!1),s=C();async function k(){if(!l.value||!a.value||!n.value||!i.value||!d.value||!m.value){await v.fire({icon:"warning",title:"欄位未填寫完整",text:"請確認所有欄位皆已填寫",confirmButtonText:"OK",confirmButtonColor:"#3085d6"});return}if(d.value!==m.value){await v.fire({icon:"error",title:"密碼不一致",text:"密碼與確認密碼不相符，請重新確認",confirmButtonText:"OK",confirmButtonColor:"#3085d6"});return}c.value=!0;const{success:B,message:t}=await s.register(l.value,i.value,d.value,a.value,n.value);c.value=!1,B?(await v.fire({icon:"success",title:"註冊成功",confirmButtonText:"OK",confirmButtonColor:"#3085d6"}),l.value="",a.value="",n.value="",i.value="",d.value="",m.value="",u("success")):await v.fire({icon:"error",title:"註冊失敗",html:t,confirmButtonText:"OK",confirmButtonColor:"#3085d6"})}function A(){u("cancel")}return(B,t)=>(y(),h("div",K,[t[12]||(t[12]=e("h2",{class:"form-title"},"註冊帳號",-1)),e("form",{onSubmit:S(k,["prevent"])},[e("div",J,[t[6]||(t[6]=e("label",{for:"name"},"姓名",-1)),g(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=f=>l.value=f),type:"text",placeholder:"請輸入姓名",required:""},null,512),[[w,l.value]])]),e("div",D,[t[7]||(t[7]=e("label",{for:"username"},"帳號",-1)),g(e("input",{id:"username","onUpdate:modelValue":t[1]||(t[1]=f=>i.value=f),type:"text",placeholder:"請輸入帳號",required:""},null,512),[[w,i.value]])]),e("div",z,[t[8]||(t[8]=e("label",{for:"email"},"Email",-1)),g(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=f=>a.value=f),type:"email",placeholder:"請輸入 Email",required:""},null,512),[[w,a.value]])]),e("div",G,[t[9]||(t[9]=e("label",{for:"phone"},"手機號碼",-1)),g(e("input",{id:"phone","onUpdate:modelValue":t[3]||(t[3]=f=>n.value=f),type:"tel",placeholder:"請輸入手機號碼",required:""},null,512),[[w,n.value]])]),e("div",H,[t[10]||(t[10]=e("label",{for:"password"},"密碼",-1)),g(e("input",{id:"password","onUpdate:modelValue":t[4]||(t[4]=f=>d.value=f),type:"password",placeholder:"請輸入密碼",required:""},null,512),[[w,d.value]])]),e("div",Q,[t[11]||(t[11]=e("label",{for:"confirmPassword"},"確認密碼",-1)),g(e("input",{id:"confirmPassword","onUpdate:modelValue":t[5]||(t[5]=f=>m.value=f),type:"password",placeholder:"再次輸入密碼",required:""},null,512),[[w,m.value]])]),e("button",{type:"submit",disabled:c.value},E(c.value?"註冊中...":"註冊"),9,W),e("button",{type:"button",class:"cancel",onClick:A,disabled:c.value}," 返回登入 ",8,X)],32)]))}}),Z=b(Y,[["__scopeId","data-v-fb790485"]]),ee={},te={id:"background"};function se(o,r){return y(),h("div",te,[q(o.$slots,"default",{},void 0)])}const oe=b(ee,[["render",se],["__scopeId","data-v-22038a82"]]),ne={},re={id:"card-container"};function le(o,r){return y(),h("div",re,[q(o.$slots,"default",{},void 0)])}const ae=b(ne,[["render",le],["__scopeId","data-v-399f7c81"]]),ie={class:"user-name"},ue={class:"text-center mt-3 p-1"},de=_({__name:"LoginView",setup(o){const r=T(),u=C(),l=$(()=>u.isAuthenticated),a=$(()=>u.getUserName),n=p(!1);function i(){u.logout(),r.push("/")}function d(){n.value=!0}function m(){n.value=!1}return(c,s)=>(y(),I(oe,null,{default:V(()=>[L(ae,null,{default:V(()=>[l.value?(y(),h(U,{key:0},[e("h2",null,[s[0]||(s[0]=x(" 歡迎 ~ ",-1)),e("span",ie,E(a.value),1),s[1]||(s[1]=x(" ! ",-1))]),s[2]||(s[2]=e("h3",null,"您已登入",-1)),e("button",{class:"logout-button",onClick:i},"登出")],64)):n.value?O("",!0):(y(),h(U,{key:1},[s[4]||(s[4]=e("h2",null,"歡迎登入!",-1)),s[5]||(s[5]=e("h3",null,"請填寫帳號密碼",-1)),L(F),e("p",ue,[s[3]||(s[3]=x(" 還沒有帳號？ ",-1)),e("a",{href:"#",class:"register-link",onClick:S(d,["prevent"])},"點此註冊")])],64)),n.value?(y(),I(Z,{key:2,onCancel:m})):O("",!0)]),_:1})]),_:1}))}}),fe=b(de,[["__scopeId","data-v-8d8fd629"]]);export{fe as default};
