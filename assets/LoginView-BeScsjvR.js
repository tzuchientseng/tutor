import{f as M,d as _,r as p,u as E,c as k,o as b,g as v,a as e,v as w,x as R,w as S,_ as h,t as q,y as A,q as I,z as V,p as L,l as U,k as B,F as N,e as x}from"./index-EKRmE4GU.js";import{S as g}from"./sweetalert2.esm.all-BQIkj5Wb.js";const O="https://home.sunnytseng.com/api/tutor/users",C=M("auth",{state:()=>{const o=sessionStorage.getItem("user")||localStorage.getItem("user"),l=o?JSON.parse(o):null;return{user:l,token:(l==null?void 0:l.token)||null}},getters:{isAuthenticated:o=>!!o.token,getUserName:o=>{var l;return((l=o.user)==null?void 0:l.name)??"Guest"}},actions:{async login(o,l,u=!1){try{const r=await fetch(`${O}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:o,password:l})}),a=await r.json();if(!r.ok){const i=a.detail||"Login failed";throw i.includes("not found")?new Error("Account does not exist"):i.includes("disabled")||i.includes("inactive")?new Error("Account is not active"):i.includes("password")?new Error("Incorrect password"):new Error(i)}const n={name:a.user.name,account:a.user.account,token:a.access};return this.setUser(n,u),{success:!0}}catch(r){return r instanceof Error?(console.error("Login error:",r.message),{success:!1,message:r.message}):{success:!1,message:"An unknown error occurred"}}},async register(o,l,u,r,a){try{const n=await fetch(`${O}/register/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,account:l,password:u,email:r,phone:a})});if(!n.ok){const i=await n.json(),c=Object.entries(i).map(([m,d])=>`<li><strong>${m}</strong>: ${d.join(", ")}</li>`).join("");throw new Error(`<ul style="text-align:left;">${c}</ul>`)}return{success:!0}}catch(n){return n instanceof Error?{success:!1,message:n.message}:{success:!1,message:"An unknown error occurred"}}},setUser(o,l=!1){this.user=o,this.token=o.token;const u=l?localStorage:sessionStorage;u.setItem("user",JSON.stringify(o)),u.setItem("token",o.token||"")},logout(){this.user=null,this.token=null,sessionStorage.removeItem("user"),sessionStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("token")}}}),j={class:"custom-checkbox-wrapper"},P=_({__name:"LoginForm",emits:["login-success"],setup(o,{emit:l}){const u=l,r=p(""),a=p(""),n=p(!1),i=E(),c=C();async function m(){g.fire({title:"Logging in...",text:"Please wait while we log you in.",allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>g.showLoading()});const d=await c.login(r.value,a.value,n.value);g.close(),d.success?g.fire({title:"Success",text:"Login successful!",icon:"success",confirmButtonColor:"#3085d6"}).then(()=>{u("login-success"),i.push("/")}):g.fire({title:"Login Failed",text:d.message,icon:"warning",confirmButtonText:"OK",confirmButtonColor:"#3085d6"})}return(d,t)=>(b(),k("form",{id:"login-form",onSubmit:S(m,["prevent"])},[v(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=y=>r.value=y),placeholder:"帳號",required:""},null,512),[[w,r.value]]),v(e("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=y=>a.value=y),placeholder:"密碼",required:""},null,512),[[w,a.value]]),e("label",null,[e("span",j,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=y=>n.value=y)},null,512),[[R,n.value]]),t[3]||(t[3]=e("span",{class:"custom-checkbox"},null,-1))]),t[4]||(t[4]=e("span",{class:"custom-checkbox-text"},"保持登入",-1))]),t[5]||(t[5]=e("button",{type:"submit"},"登入",-1))],32))}}),F=h(P,[["__scopeId","data-v-16549392"]]),J={class:"mb-3"},D={class:"mb-3"},K={class:"mb-3"},z={class:"mb-3"},G={class:"mb-3"},H={class:"mb-3"},Q=["disabled"],W=["disabled"],X=_({__name:"RegisterModal",emits:["success","cancel"],setup(o,{emit:l}){const u=l,r=p(""),a=p(""),n=p(""),i=p(""),c=p(""),m=p(""),d=p(!1),t=C();async function y(){if(!r.value||!a.value||!n.value||!i.value||!c.value||!m.value){await g.fire({icon:"warning",title:"欄位未填寫完整",text:"請確認所有欄位皆已填寫"});return}if(c.value!==m.value){await g.fire({icon:"error",title:"密碼不一致",text:"密碼與確認密碼不相符，請重新確認"});return}d.value=!0;const{success:$,message:s}=await t.register(r.value,i.value,c.value,a.value,n.value);d.value=!1,$?(await g.fire({icon:"success",title:"註冊成功",confirmButtonText:"OK",confirmButtonColor:"#3085d6"}),r.value="",a.value="",n.value="",i.value="",c.value="",m.value="",u("success")):await g.fire({icon:"error",title:"註冊失敗",html:s,confirmButtonText:"確定",confirmButtonColor:"#3085d6"})}function T(){u("cancel")}return($,s)=>(b(),k("form",{onSubmit:S(y,["prevent"])},[e("div",J,[s[6]||(s[6]=e("label",{for:"name",class:"form-label"},"姓名",-1)),v(e("input",{type:"text",id:"name","onUpdate:modelValue":s[0]||(s[0]=f=>r.value=f),class:"form-control",placeholder:"請輸入姓名",required:""},null,512),[[w,r.value]])]),e("div",D,[s[7]||(s[7]=e("label",{for:"username",class:"form-label"},"帳號",-1)),v(e("input",{type:"text",id:"username","onUpdate:modelValue":s[1]||(s[1]=f=>i.value=f),class:"form-control",placeholder:"請輸入帳號",required:""},null,512),[[w,i.value]])]),e("div",K,[s[8]||(s[8]=e("label",{for:"email",class:"form-label"},"Email",-1)),v(e("input",{type:"email",id:"email","onUpdate:modelValue":s[2]||(s[2]=f=>a.value=f),class:"form-control",placeholder:"請輸入 Email",required:""},null,512),[[w,a.value]])]),e("div",z,[s[9]||(s[9]=e("label",{for:"phone",class:"form-label"},"手機號碼",-1)),v(e("input",{type:"tel",id:"phone","onUpdate:modelValue":s[3]||(s[3]=f=>n.value=f),class:"form-control",placeholder:"請輸入手機號碼",required:""},null,512),[[w,n.value]])]),e("div",G,[s[10]||(s[10]=e("label",{for:"password",class:"form-label"},"密碼",-1)),v(e("input",{type:"password",id:"password","onUpdate:modelValue":s[4]||(s[4]=f=>c.value=f),class:"form-control",placeholder:"請輸入密碼",required:""},null,512),[[w,c.value]])]),e("div",H,[s[11]||(s[11]=e("label",{for:"confirmPassword",class:"form-label"},"確認密碼",-1)),v(e("input",{type:"password",id:"confirmPassword","onUpdate:modelValue":s[5]||(s[5]=f=>m.value=f),class:"form-control",placeholder:"再次輸入密碼",required:""},null,512),[[w,m.value]])]),e("button",{type:"submit",class:"btn btn-primary w-100 mb-2",disabled:d.value},q(d.value?"註冊中...":"註冊"),9,Q),e("button",{type:"button",class:"btn btn-secondary w-100",onClick:T,disabled:d.value}," 返回登入 ",8,W)],32))}}),Y=h(X,[["__scopeId","data-v-e0377d20"]]),Z={},ee={id:"background"};function te(o,l){return b(),k("div",ee,[A(o.$slots,"default",{},void 0)])}const se=h(Z,[["render",te],["__scopeId","data-v-22038a82"]]),oe={},ne={id:"card-container"};function le(o,l){return b(),k("div",ne,[A(o.$slots,"default",{},void 0)])}const re=h(oe,[["render",le],["__scopeId","data-v-399f7c81"]]),ae={class:"user-name"},ie={class:"text-center mt-3 p-1"},ue=_({__name:"LoginView",setup(o){const l=E(),u=C(),r=I(()=>u.isAuthenticated),a=I(()=>u.getUserName),n=p(!1);function i(){u.logout(),l.push("/")}function c(){n.value=!0}function m(){n.value=!1}return(d,t)=>(b(),V(se,null,{default:L(()=>[U(re,null,{default:L(()=>[r.value?(b(),k(N,{key:0},[e("h2",null,[t[0]||(t[0]=x(" 歡迎 ~ ",-1)),e("span",ae,q(a.value),1),t[1]||(t[1]=x(" ! ",-1))]),t[2]||(t[2]=e("h3",null,"您已登入",-1)),e("button",{class:"logout-button",onClick:i},"登出")],64)):n.value?B("",!0):(b(),k(N,{key:1},[t[4]||(t[4]=e("h2",null,"歡迎登入!",-1)),t[5]||(t[5]=e("h3",null,"請填寫帳號密碼",-1)),U(F),e("p",ie,[t[3]||(t[3]=x(" 還沒有帳號？ ",-1)),e("a",{href:"#",class:"register-link",onClick:S(c,["prevent"])},"點此註冊")])],64)),n.value?(b(),V(Y,{key:2,onCancel:m})):B("",!0)]),_:1})]),_:1}))}}),me=h(ue,[["__scopeId","data-v-8d8fd629"]]);export{me as default};
